// UWSC Script to close cmd.exe window by PID
// Usage: UWSC.exe close_cmd_window.uws <PID>

// Get PID from command line argument
PID = PARAM_STR[0]

IF PID = "" THEN
    MSGBOX("Usage: UWSC.exe close_cmd_window.uws <PID>")
    EXIT
ENDIF

// Find window by process ID
HWND = 0
FOR i = 0 TO 100
    h = GETID("", "", i)
    IF h = -1 THEN BREAK
    
    // Get process ID of this window
    wPID = GETID(h, "PID")
    IF wPID = VAL(PID) THEN
        HWND = h
        BREAK
    ENDIF
NEXT

IF HWND = 0 THEN
    PRINT "Window not found for PID: " + PID
    EXIT
ENDIF

PRINT "Found window for PID " + PID + ", HWND: " + HWND

// Try to close window gracefully
// Method 1: Send WM_CLOSE
CTRLWIN(HWND, CLOSE)
SLEEP(1)

// Check if window still exists
IF GETID(HWND) <> -1 THEN
    PRINT "Window still exists, trying Alt+F4"
    // Method 2: Activate and send Alt+F4
    CTRLWIN(HWND, ACTIVATE)
    SLEEP(0.5)
    SCKEY(HWND, VK_F4, ALT)
    SLEEP(1)
ENDIF

// Check again
IF GETID(HWND) <> -1 THEN
    PRINT "Window still exists, force closing"
    // Method 3: Force close
    CTRLWIN(HWND, CLOSE2)
ENDIF

PRINT "Close command sent"