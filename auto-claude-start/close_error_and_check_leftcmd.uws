// エラーダイアログを閉じて、左上のcmdウィンドウを確認

// まず現在の状態をキャプチャ
SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\before_error_close.jpg", 0, , , , , , 80)

// エラーダイアログを閉じる
// "NOT が定義されていません" エラーを探す
count = GETALLWIN()
FOR i = 0 TO count - 1
    id = ALL_WIN_ID[i]
    IF id > 0 THEN
        title = STATUS(id, ST_TITLE)
        IF POS("Error", title) > 0 OR POS("エラー", title) > 0 OR POS("UWSC", title) > 0 THEN
            // エラーダイアログを閉じる
            CLKITEM(id, "OK", CLK_BTN)
            SLEEP(0.5)
        ENDIF
    ENDIF
NEXT

// エラー閉じた後の状態
SLEEP(1)
SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\after_error_close.jpg", 0, , , , , , 80)

// 左上のcmdウィンドウを探す
// 座標的に左上にあるウィンドウを探す
fid = FOPEN("C:\Users\user\claude-test-100-v0.2\auto-claude-start\leftcmd_check.txt", F_WRITE)
FPUT(fid, "=== Left CMD Window Check ===")
FPUT(fid, "")

FOR i = 0 TO count - 1
    id = ALL_WIN_ID[i]
    IF id > 0 THEN
        title = STATUS(id, ST_TITLE)
        clsname = STATUS(id, ST_CLASS)
        visible = STATUS(id, ST_VISIBLE)
        
        // cmdウィンドウで、私のウィンドウじゃないもの
        IF (POS("cmd", title) > 0 OR clsname = "ConsoleWindowClass" OR clsname = "PseudoConsoleWindow") AND visible THEN
            // 私のウィンドウかチェック
            IF POS("claude-test-100", title) = 0 AND POS("auto-claude-start", title) = 0 THEN
                FPUT(fid, "Found other CMD:")
                FPUT(fid, "  ID: " + id)
                FPUT(fid, "  Title: " + title)
                FPUT(fid, "  Class: " + clsname)
                
                // このウィンドウをアクティブにして確認
                CTRLWIN(id, ACTIVATE)
                SLEEP(1)
                SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\leftcmd_activated_" + id + ".jpg", 0, , , , , , 80)
                
                FPUT(fid, "")
            ENDIF
        ENDIF
    ENDIF
NEXT

FCLOSE(fid)