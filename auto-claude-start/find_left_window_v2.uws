// 左側のウィンドウを別の方法で特定

// 現在の状態
SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\find_left_v2.jpg", 0, , , , , , 80)

// ログファイル
fid = FOPEN("C:\Users\user\claude-test-100-v0.2\auto-claude-start\find_left_v2_log.txt", F_WRITE)
FPUT(fid, "=== Finding Left Window V2 ===")
FPUT(fid, "")

// 全ウィンドウを詳細に調査
count = GETALLWIN()
FPUT(fid, "Total windows: " + count)
FPUT(fid, "")

FOR i = 0 TO count - 1
    id = ALL_WIN_ID[i]
    IF id > 0 THEN
        title = STATUS(id, ST_TITLE)
        clsname = STATUS(id, ST_CLASS)
        visible = STATUS(id, ST_VISIBLE)
        pid = STATUS(id, ST_PROCESS)
        
        // cmd.exe関連のウィンドウを全て記録
        IF visible AND (clsname = "ConsoleWindowClass" OR clsname = "PseudoConsoleWindow" OR clsname = "CASCADIA_HOSTING_WINDOW_CLASS") THEN
            FPUT(fid, "Window ID: " + id)
            FPUT(fid, "  Title: " + title)
            FPUT(fid, "  Class: " + clsname)
            FPUT(fid, "  PID: " + pid)
            
            // 私のメインウィンドウでない場合（右側のウィンドウでない）
            IF POS("Technical Feature", title) = 0 THEN
                FPUT(fid, "  >>> This might be the left window!")
                
                // このウィンドウを最大化してテスト
                CTRLWIN(id, MAX)
                SLEEP(1)
                SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\test_max_" + id + ".jpg", 0, , , , , , 80)
                
                // 最小化
                CTRLWIN(id, MIN)
                SLEEP(1)
                SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\test_min_" + id + ".jpg", 0, , , , , , 80)
                
                // 3秒停止
                FPUT(fid, "  Waiting 3 seconds...")
                SLEEP(3)
                
                // 元に戻す
                CTRLWIN(id, NORMAL)
                SLEEP(1)
                SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\test_normal_" + id + ".jpg", 0, , , , , , 80)
                
                // 閉じる
                FPUT(fid, "  Closing window...")
                CTRLWIN(id, CLOSE)
                SLEEP(1)
                
                // 確認
                IF GETID(id) = -1 THEN
                    FPUT(fid, "  Successfully closed!")
                ELSE
                    FPUT(fid, "  Still exists, force closing...")
                    CTRLWIN(id, CLOSE2)
                ENDIF
                
                BREAK  // 最初に見つけたものだけ処理
            ENDIF
            
            FPUT(fid, "")
        ENDIF
    ENDIF
NEXT

FCLOSE(fid)

// 最終結果
SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\final_result_v2.jpg", 0, , , , , , 80)