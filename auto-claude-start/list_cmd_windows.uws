// コマンドプロンプトウィンドウ一覧を取得

// まず現在の状態をスクリーンショット
SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\cmd_windows_before.jpg", 0, , , , , , 80)

// ログファイル
fid = FOPEN("C:\Users\user\claude-test-100-v0.2\auto-claude-start\cmd_windows_list.txt", F_WRITE)
FPUT(fid, "=== コマンドプロンプト一覧 ===")
FPUT(fid, "")

// 全ウィンドウを取得
count = GETALLWIN()
cmd_count = 0

// cmd.exeウィンドウを探す
FOR i = 0 TO count - 1
    id = ALL_WIN_ID[i]
    IF id > 0 THEN
        title = STATUS(id, ST_TITLE)
        clsname = STATUS(id, ST_CLASS)
        pid = STATUS(id, ST_PROCESS)
        
        // cmd.exeのウィンドウを探す
        IF POS("cmd.exe", title) > 0 OR clsname = "ConsoleWindowClass" OR clsname = "PseudoConsoleWindow" THEN
            cmd_count = cmd_count + 1
            FPUT(fid, "CMD #" + cmd_count)
            FPUT(fid, "  Window ID: " + id)
            FPUT(fid, "  PID: " + pid)
            FPUT(fid, "  Title: " + title)
            FPUT(fid, "  Class: " + clsname)
            FPUT(fid, "  Visible: " + STATUS(id, ST_VISIBLE))
            
            // 現在アクティブかチェック
            IF GETID(GET_ACTIVE) = id THEN
                FPUT(fid, "  *** ACTIVE WINDOW ***")
            ENDIF
            
            FPUT(fid, "")
        ENDIF
    ENDIF
NEXT

FPUT(fid, "総cmd.exeウィンドウ数: " + cmd_count)
FCLOSE(fid)