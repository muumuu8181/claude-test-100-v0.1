// 左側の空のウィンドウをサイズ変更テストしてから閉じる

// 現在の状態をキャプチャ
SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\before_resize_test.jpg", 0, , , , , , 80)

// 左側のウィンドウを特定（空のWindows Terminal）
count = GETALLWIN()
left_window_id = 0

FOR i = 0 TO count - 1
    id = ALL_WIN_ID[i]
    IF id > 0 THEN
        title = STATUS(id, ST_TITLE)
        visible = STATUS(id, ST_VISIBLE)
        
        // 空のPowerShell/Windows Terminalを探す
        IF visible AND (POS("PowerShell", title) > 0 OR POS("Windows Terminal", title) > 0) THEN
            // 私のメインウィンドウじゃないか確認
            IF POS("claude-test-100", title) = 0 AND POS("auto-claude-start", title) = 0 THEN
                left_window_id = id
                BREAK
            ENDIF
        ENDIF
    ENDIF
NEXT

// ログ記録
fid = FOPEN("C:\Users\user\claude-test-100-v0.2\auto-claude-start\resize_test_log.txt", F_WRITE)
FPUT(fid, "Left window ID found: " + left_window_id)

IF left_window_id > 0 THEN
    window_title = STATUS(left_window_id, ST_TITLE)
    FPUT(fid, "Window title: " + window_title)
    FPUT(fid, "")
    
    // ステップ1: 大きくする
    FPUT(fid, "Step 1: Maximize window")
    CTRLWIN(left_window_id, MAX)
    SLEEP(1)
    SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\step1_maximized.jpg", 0, , , , , , 80)
    
    // ステップ2: 小さくする
    FPUT(fid, "Step 2: Minimize window")
    CTRLWIN(left_window_id, MIN)
    SLEEP(1)
    SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\step2_minimized.jpg", 0, , , , , , 80)
    
    // ステップ3: 3秒停止
    FPUT(fid, "Step 3: Wait 3 seconds")
    SLEEP(3)
    
    // ステップ4: 元に戻す
    FPUT(fid, "Step 4: Restore window")
    CTRLWIN(left_window_id, NORMAL)
    SLEEP(1)
    SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\step4_restored.jpg", 0, , , , , , 80)
    
    // ステップ5: 閉じる
    FPUT(fid, "Step 5: Close window")
    CTRLWIN(left_window_id, CLOSE)
    SLEEP(1)
    
    // 確認
    IF GETID(left_window_id) = -1 THEN
        FPUT(fid, "Successfully closed left window")
    ELSE
        FPUT(fid, "Still exists, trying force close")
        CTRLWIN(left_window_id, CLOSE2)
    ENDIF
    
ELSE
    FPUT(fid, "Left window not found")
ENDIF

FCLOSE(fid)

// 最終状態
SAVEIMG("C:\Users\user\claude-test-100-v0.2\auto-claude-start\final_after_close_left.jpg", 0, , , , , , 80)