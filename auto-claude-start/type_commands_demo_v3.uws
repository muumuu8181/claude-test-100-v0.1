// UWSCスクリプト - キーボード入力テスト（正しい方法）
// GETALLWIN()で実際の数字IDを取得してから文字入力

// まず全ウィンドウを取得
count = GETALLWIN()
ps_window_id = 0

// PowerShellウィンドウを探す
FOR i = 0 TO count - 1
    id = ALL_WIN_ID[i]
    IF id > 0 THEN
        title = STATUS(id, ST_TITLE)
        clsname = STATUS(id, ST_CLASS)
        
        // PowerShellまたはコンソールウィンドウを探す
        IF POS("PowerShell", title) > 0 OR POS("Console", clsname) > 0 OR POS("CASCADIA", clsname) > 0 THEN
            ps_window_id = id
            PRINT "PowerShell発見: ID=" + id + " タイトル=" + title
            BREAK
        ENDIF
    ENDIF
NEXT

// ウィンドウが見つからない場合は終了
IF ps_window_id = 0 THEN
    PRINT "PowerShellウィンドウが見つかりません"
    EXIT
ENDIF

// ウィンドウをアクティブにする
CTRLWIN(ps_window_id, ACTIVATE)
SLEEP(1)

// 実際の数字IDで文字列を送信
PRINT "文字入力開始: ウィンドウID=" + ps_window_id
SENDSTR(ps_window_id, "Hello from UWSC")
SLEEP(0.5)

// Enterキーを送信
SCKEY(ps_window_id, VK_RETURN)
SLEEP(0.5)

SENDSTR(ps_window_id, "echo 成功しました")
SLEEP(0.5)
SCKEY(ps_window_id, VK_RETURN)

PRINT "文字入力完了"